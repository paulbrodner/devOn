# Welcome
>Throw some pixy dust on your test environment
>[devon](https://github.com/paulbrodner/devon)  - copyright 2018 (c) Paul Brodner

This project structure is automatically generated by [devon](https://github.com/paulbrodner/devon) 

Checkout the guidelines bellow on how to use it, how to configure it, hot to add new scripts according to your needs.

# Usage
The structure of this project if defined as:
```ruby
├── Gemfile             # contains the ruby gemfiles
├── LICENSE             # license
├── README.md           # this readme file
├── Rakefile            # devon rake commands, here you can define your own commands too if you like
├── config.ru           # used for starting up Sinatra server
├── configs             # contains all Configuration files
│   ├── simple
│   │   └── sample.txt.erb
│   └── simple.rb       # one configuration that will execute a shell script    
├── connections         # contains all Connextion settings
│   ├── env.yml
│   ├── env.yml.example
│   ├── vagrant         # vagrant folder for spinning up one virtual machine for testing purposes
│   │   └── Vagrantfile
│   └── vagrant.rb
└── scripts
    └── connect.rb      # one simple script that will run a shell script if connection is succesfull
```

### List available commands

Open one terminal and navigate to the root folder of this project, then type:

```ruby
$ rake -T
```
This command will show you all available `devon` commands that you can run on this project structure

**Example** (from devon v2.0.0):

```ruby
rake configs:list                               # List available configurations
rake configs:new                                # Create a new Configuration
rake conn:list                                  # List available connections
rake db:init                                    # Initi/Reinitialize db
rake scripts:list                               # List available scripts
rake scripts:new                                # Create a new script
rake scripts:run                                # Run script (in bash: rake scripts:run CMD=1,2,3 INTERACTIVE=TRUE)
rake scripts:run_all[script,connection,config]  # Run script (in bash: rake scripts:run CMD=1,2,3 INTERACTIVE=TRUE)
rake server:up                                  # Start Sinatra Server
```

### List available SCRIPTS

```ruby
$ rake scripts:list 
```

The command will display all files available in `scripts` folder:

```ruby
[
    [0] "scripts/connect.rb"
]
```
If multiple scripts are created inside `scripts` folder, each one of them is displayed with a particular ID (0-> n)

### List available CONNECTIONS

```ruby
$ rake conn:list
```

The command result will display all files available in `connections` folder:
```ruby
[
    [0] "connections/vagrant.rb {127.0.0.1}"
]
```
If multiple scripts are created inside `connections` folder, each one of them is displayed with a particular ID (0-> n).

Notice that the IP of the target machine is also displayed (taken automatically from env.yml), in order to identify easier what connection to use.

### Run scripts

```ruby
$ rake scripts:run
```
One interactive shell is executed. 

**a)** First it will list all available scripts (as we saw above) and ask you to choose a script file to execute from that list.

Let's check the existing one `0` when `Choose a file from scripts to use:` text is displayed and press ENTER.

>**Hint:** for the file available at location `0` you can also press ENTER directly, no need to type `0` then ENTER.

**b)** The interactive task will then display all available connections as we saw in previous paragraph. Type `0` and press ENTER again.

>**Hint:** for the file available at location `0` you can also press ENTER directly, no need to type `0` then ENTER.

Next a list of available configurations is displayed (i.e. what configuration should this tool use in combination with your script). 

In our case, we just execute a shell script (see scripts/connect.rb) listing all files based on choosen configuration (see connections/vagrant.rb), so "No config" can be choosen.  

![#f03c15](https://placehold.it/15/f03c15/000000?text=+) `Info`
> If you have access to a remote machine via SSH, please change the `connection/env.yml` file, setting up the correct IP address and connection credentials, or spin up a local Virtual Machine using the guideline bellow.

> If you want run a particular script in non-interactive way, you can use the `scripts:run_all` task:
```ruby
$ rake scripts:run_all['scripts/connect.rb','connections/vagrant.rb','']
```

### Playing with Virtual Machine (optional)

The `connections/vagrant` folder contains one `Vagrantfile` that will spin up a test virtual machine for you.

![#f03c15](https://placehold.it/15/f03c15/000000?text=+) `Prerequisites`
>You need to have [Vagrant](https://www.vagrantup.com/) installed on your machine and [VirtualBox](https://www.virtualbox.org/)

Open a new terminal and navigate to `connection/vagrant` and type:

```shell
$ vagrant up
```
This will download and configure for you in the background  one Ubuntu test machine that you can use for further testing using the default script.


### Adding new scripts

## configs

Contains configuration files (let's say differed variables, files, shell commands, available 
in a structure logical order.
Each "scripts" can be executed using a specific configuration over one active connection.
Each configuration, will be compatible with one or more scripts. (don't define add_compatibility! and the config file will be available for all scripts)

```ruby
Config.<config_name>.add_compatibility!("<script_name1")
Config.<config_name>.add_compatibility!("<script_name2")
```

## connections

Contains connection related settings for VMs, Remote machines, amazon instances, rackspace, etc.
You can define sensitive information (password, tokens, into env.yml file).
(add new section in env.yml file using the same name of the configuration file: i.e. vagrant.rb connection will have a 'vagrant' section in env.yml file)

## scripts  
Are the actual scripts that will be executed over an active connection with a default configuration file.

## global variables

$config 	- is the current configuration ("configs") file active
$connection - is the current connection ("connections") file active
(This can be used in 'configs' or 'scripts')

## Usage

Clone the repository

```ruby
git clone https://github.com/paulbrodner/devon
```

Modify configuration/scripts files as you wish and run rake helper commands

```ruby
rake -T # for a list of available tasks
```

